##HIVE##

##Step 1: Database creation
create database nyc_parking_violations;

##Step 2: Use of created Database
use nyc_parking_violations; 


##Step 3: Creation of External Table for parking violation issued dataset.
CREATE EXTERNAL TABLE IF NOT EXISTS PARKING_VIOLATIONS (
Summons_Number STRING, Plate_ID STRING, Registration_State STRING,
Plate_Type STRING, Issue_Date STRING, Violation_Code STRING,
Vehicle_Body_Type STRING, Vehicle_Make STRING,Issuing_Agency STRING,
Street_Code1 STRING,Vehicle_Expiration_Date STRING,Violation_Location STRING,Issuer_Code STRING,Issuer_Command STRING,
Violation_Time STRING,Time_First_Observed STRING,
Violation_County STRING,Violation_In_Front_Of_Or_Opp STRING,
Street_Name STRING,Law_Section STRING,Days_Parking_In_Effect STRING,From_Hours_In_Effect STRING,To_Hours_In_Effect STRING,
Vehicle_Color STRING,Vehicle_Year STRING
)
COMMENT 'The New York City Parking Violations for fiscal year 2018'
ROW FORMAT DELIMITED
FIELDS TERMINATED BY ','
STORED AS TEXTFILE
location 'gs://pda-org-data/'
tblproperties ("skip.header.line.count"="1");




##Step4: Creation of Hive Managed Table for parking violation issued dataset.
CREATE TABLE IF NOT EXISTS PARKING_VIOLATIONS_HIVE(
Summons_Number STRING, Plate_ID STRING, Registration_State STRING,
Plate_Type STRING, Issue_Date STRING, Violation_Code STRING,
Vehicle_Body_Type STRING, Vehicle_Make STRING,Issuing_Agency STRING,
Street_Code1 STRING,Vehicle_Expiration_Date STRING,Violation_Location STRING,Issuer_Code STRING,Issuer_Command STRING,
Violation_Time STRING,Time_First_Observed STRING,
Violation_County STRING,Violation_In_Front_Of_Or_Opp STRING,
Street_Name STRING,Law_Section STRING,Days_Parking_In_Effect STRING,From_Hours_In_Effect STRING,To_Hours_In_Effect STRING,
Vehicle_Color STRING,Vehicle_Year STRING
)
COMMENT 'Data of New York City Parking Violations for fiscal year 2018'
ROW FORMAT DELIMITED
FIELDS TERMINATED BY ','
STORED AS TEXTFILE;


##Step 5 : Creation of External Table for Violation Codes data.
CREATE EXTERNAL TABLE VIOL_CODES (CODE STRING,DEFINITION STRING,Manhattan96thStbelow STRING, All_Other_Areas STRING) ROW FORMAT DELIMITED FIELDS TERMINATED BY ',' LOCATION 'gs://pda-org-data/Violation_Codes/' tblproperties ("skip.header.line.count"="1");


##Step 6: Creation of Hive Managed Table for Violation Codes data.
CREATE TABLE IF NOT EXISTS VIOL_CODES(
CODE INT,DEFINITION STRING,Manhattan96thStbelow INT,All_Other_Areas INT
)
COMMENT 'Parking Violation Code and Fines New York City'
ROW FORMAT DELIMITED
FIELDS TERMINATED BY ','
STORED AS TEXTFILE; 



##Step 7 : Load Violation Codes data into hive managed using external table.

INSERT OVERWRITE TABLE PARKING_VIOLATIONS_HIVE
SELECT CAST(Summons_Number AS INT),Plate_ID,Registration_State,Plate_Type,
Issue_Date,CAST(Violation_Code AS INT),Vehicle_Body_Type,Vehicle_Make,Issuing_Agency,
CAST(Street_Code1 AS INT),
CAST(Vehicle_Expiration_Date AS INT),Violation_Location,
Issuer_Code,Issuer_Command ,
Violation_Time,Time_First_Observed,Violation_County,Violation_In_Front_Of_Or_Opp,
Street_Name,CAST(Law_Section AS INT),Days_Parking_In_Effect,
From_Hours_In_Effect,To_Hours_In_Effect,Vehicle_Color,
CAST(Vehicle_Year AS INT)
FROM PARKING_VIOLATIONS;



##Step 8 : Load Parking Violations Issued data into hive managed using external table.
INSERT OVERWRITE TABLE VIOL_CODES
SELECT
CAST(CODE AS INT),
DEFINITION STRING,
CAST(Manhattan96thStbelow AS INT),
CAST(All_Other_Areas AS INT)
FROM VIOL_CODES_EXT;


#Query 1 : Violations and revenue generated by parking violations in NYC during 2018.
#Query 2: Vehicle-makes that have the highest number of reported violations in the year.


